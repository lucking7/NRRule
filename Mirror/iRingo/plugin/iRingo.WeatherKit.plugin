#!name = ï£¿ iRingo: ðŸŒ¤ ï£¿WeatherKit
#!desc = iOS 18 & macOS 15 & watchOS 11\n1.è§£é”å…¨éƒ¨å¤©æ°”åŠŸèƒ½\n2.æ›¿æ¢ç©ºæ°”è´¨é‡æ•°æ®\n3.æ·»åŠ ä¸‹ä¸€å°æ—¶é™æ°´æ•°æ®\n4.æ·»åŠ å¤©æ°”æ•°æ®
#!openUrl = http://boxjs.com/#/app/iRingo.WeatherKit
#!author = VirgilClyne[https://github.com/VirgilClyne],WordlessEcho[https://github.com/WordlessEcho],001[https://github.com/001ProMax]
#!homepage = https://NSRingo.github.io/guide/Weather/weather-kit
#!icon = https://developer.apple.com/assets/elements/icons/weatherkit/weatherkit-128x128.png
#!tag = ï£¿ iRingo
#!system = iOS,iPadOS,macOS,watchOS
#!date = 2026-02-19 19:04:59
#!version = 3.0.2
#!system_version = 18

[Argument]
Weather.Replace = input,"CN",tag=[å¤©æ°”] æ›¿æ¢åœ°åŒº,desc=æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªæ›¿æ¢æŒ‡å®šåœ°åŒºçš„å¤©æ°”ã€‚
Weather.Provider = select,"ColorfulClouds","QWeather",tag=[å¤©æ°”] æ•°æ®æº,desc=ä½¿ç”¨é€‰å®šçš„æ•°æ®æºæ›¿æ¢å¤©æ°”æ•°æ®ã€‚
NextHour.Fill = input,"CN|HK|MO|TW|IT|LT|MT|FR|SK|NO|BY|IS|CZ|SI|DE|ES|UA|DK|PL|FI|SE|HR|RU|RO|PT|EE|RS|AT|GR|HU|FJ|GU|MH|NC|TR|BH|SA|ID|IR|SG|OM|PH|IN|KH|CY|MY|VN|KW|TH|KR|KP|CA|BS|KY|MX|PA|MQ|CU|BM|PR|CW|GP|NI|BR|GF|CO|GY|PY|AR",tag=[æœªæ¥ä¸€å°æ—¶é™æ°´å¼ºåº¦] å¡«è¡¥åœ°åŒº,desc=æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªå¡«è¡¥æŒ‡å®šåœ°åŒºçš„æœªæ¥ä¸€å°æ—¶é™æ°´å¼ºåº¦ã€‚
NextHour.Provider = select,"ColorfulClouds","QWeather",tag=[æœªæ¥ä¸€å°æ—¶é™æ°´å¼ºåº¦] æ•°æ®æº,desc=ä½¿ç”¨é€‰å®šçš„æ•°æ®æºå¡«å……æœªæ¥ä¸€å°æ—¶é™æ°´å¼ºåº¦çš„æ•°æ®ã€‚
AirQuality.Current.Fill = input,"CN|HK|MO",tag=[ç©ºæ°”è´¨é‡ - ä»Šæ—¥] å¡«è¡¥åœ°åŒº,desc=æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªå¡«è¡¥æŒ‡å®šåœ°åŒºçš„ä»Šæ—¥ç©ºæ°”è´¨é‡æ•°æ®ã€‚
AirQuality.Current.Pollutants.Provider = select,"ColorfulClouds","QWeather",tag=[ä»Šæ—¥æ±¡æŸ“ç‰©] æ•°æ®æº,desc=ä½¿ç”¨é€‰å®šçš„æ•°æ®æºå¡«è¡¥æ±¡æŸ“ç‰©æ•°æ®ã€‚
AirQuality.Current.Index.Replace = input,"HJ6332012",tag=[ä»Šæ—¥ç©ºæ°”æŒ‡æ•°] æ›¿æ¢ç›®æ ‡,desc=æ›¿æ¢æŒ‡å®šæ ‡å‡†çš„ç©ºæ°”è´¨é‡æŒ‡æ•°ã€‚
AirQuality.Current.Index.Provider = select,"Calculate","ColorfulCloudsUS","ColorfulCloudsCN","QWeather","WAQI",tag=[ä»Šæ—¥ç©ºæ°”æŒ‡æ•°] æ•°æ®æº,desc=ä½¿ç”¨é€‰å®šçš„æ•°æ®æºå¡«è¡¥å’Œæ›¿æ¢ç©ºæ°”è´¨é‡æŒ‡æ•°ã€‚
AirQuality.Current.Index.ForceCNPrimaryPollutants = switch,true,tag=[ä»Šæ—¥ç©ºæ°”æŒ‡æ•°] å¼ºåˆ¶ä¸»è¦æ±¡æŸ“ç‰©,desc=å¿½ç•¥å›½æ ‡ï¼ˆHJ 633â€”2012ï¼‰çš„AQI > 50è§„å®šï¼Œå§‹ç»ˆå°†IAQIæœ€å¤§çš„ç©ºæ°”æ±¡æŸ“ç‰©ä½œä¸ºä¸»è¦æ±¡æŸ“ç‰©ã€‚
AirQuality.Comparison.Fill = input,"CN|HK|MO",tag=[ç©ºæ°”è´¨é‡ - å¯¹æ¯”æ˜¨æ—¥] å¡«è¡¥åœ°åŒº,desc=æ­£åˆ™è¡¨è¾¾å¼ï¼Œåªå¡«è¡¥æŒ‡å®šåœ°åŒºçš„å¯¹æ¯”æ˜¨æ—¥æ•°æ®ã€‚
AirQuality.Comparison.Yesterday.PollutantsProvider = select,"QWeather",,tag=[æ˜¨æ—¥æ±¡æŸ“ç‰©] æ•°æ®æº,desc=ä¸ºiRingoå†…ç½®ç®—æ³•æä¾›æ±¡æŸ“ç‰©æ•°æ®ï¼Œè®¡ç®—å‡ºæ˜¨æ—¥çš„ç©ºæ°”è´¨é‡æŒ‡æ•°ã€‚
AirQuality.Comparison.Yesterday.IndexProvider = select,"ColorfulCloudsUS","Calculate","ColorfulCloudsCN","QWeather",tag=[æ˜¨æ—¥ç©ºæ°”æŒ‡æ•°] æ•°æ®æº,desc=ç”¨æ¥å’Œä»Šæ—¥ç©ºæ°”è´¨é‡æŒ‡æ•°å¯¹æ¯”çš„æ•°æ®ã€‚
AirQuality.Calculate.Algorithm = select,"UBA","EU_EAQI","WAQI_InstantCast_US","WAQI_InstantCast_CN","WAQI_InstantCast_CN_25_DRAFT",tag=[iRingoå†…ç½®ç®—æ³•] ç®—æ³•,desc=ä½¿ç”¨å†…ç½®ç®—æ³•ï¼Œé€šè¿‡æ±¡æŸ“ç‰©æ•°æ®æœ¬åœ°è®¡ç®—ç©ºæ°”æŒ‡æ•°ã€‚InstantCastæºè‡ªäºŽWAQIï¼Œç¾Žæ ‡ç‰ˆæœ¬ä½¿ç”¨äº†WAQIçš„è‡­æ°§æ ‡å‡†ã€‚
AirQuality.Calculate.AllowOverRange = switch,true,tag=[iRingoå†…ç½®ç®—æ³•] å…è®¸æŒ‡æ•°è¶…æ ‡,desc=å…è®¸ç¾Žæ ‡å’Œå›½æ ‡çš„æŒ‡æ•°è¶…è¿‡500ã€‚è¶…è¿‡500æ—¶ï¼ŒæŒ‡ç¤ºé¢œè‰²çš„å°åœ†ç‚¹ä¼šæ¶ˆå¤±ã€‚
API.ColorfulClouds.Token = input,"",tag=[API] å½©äº‘å¤©æ°”ä»¤ç‰Œ,desc=å½©äº‘å¤©æ°” API ä»¤ç‰Œ
API.QWeather.Host = input,"devapi.qweather.com",tag=[API] å’Œé£Žå¤©æ°”ä¸»æœº,desc=å’Œé£Žå¤©æ°” API ä½¿ç”¨çš„ä¸»æœºå
API.QWeather.Token = input,"",tag=[API] å’Œé£Žå¤©æ°”ä»¤ç‰Œ,desc=å’Œé£Žå¤©æ°” API ä»¤ç‰Œ
API.WAQI.Token = input,"",tag=[API] WAQI ä»¤ç‰Œ,desc=WAQI API ä»¤ç‰Œï¼Œå¡«å†™æ­¤å­—æ®µå°†è‡ªåŠ¨ä½¿ç”¨WAQIé«˜çº§API
Storage = select,"$argument","PersistentStore","database",tag=[å‚¨å­˜] é…ç½®ç±»åž‹,desc=é€‰æ‹©è¦ä½¿ç”¨çš„é…ç½®ç±»åž‹ã€‚æœªè®¾ç½®æ­¤é€‰é¡¹æˆ–ä¸é€šè¿‡æ­¤é€‰é¡¹çš„æ—§ç‰ˆæœ¬çš„é…ç½®é¡ºåºä¾æ—§æ˜¯ PersistentStore(BoxJs) > $argument > databaseã€‚
LogLevel = select,"WARN","OFF","ERROR","INFO","DEBUG","ALL",tag=[è°ƒè¯•] æ—¥å¿—ç­‰çº§,desc=é€‰æ‹©è„šæœ¬æ—¥å¿—çš„è¾“å‡ºç­‰çº§ï¼Œä½ŽäºŽæ‰€é€‰ç­‰çº§çš„æ—¥å¿—å°†å…¨éƒ¨è¾“å‡ºã€‚

[Rule]
DOMAIN,weather-analytics-events.apple.com,REJECT-DROP
DOMAIN-SUFFIX,tthr.apple.com,REJECT-DROP
DOMAIN,tether.edge.apple,REJECT-DROP
AND,((IP-ASN,714,no-resolve),(PROTOCOL,QUIC)),REJECT-DROP

[Script]
http-response ^https?:\/\/weatherkit\.apple\.com\/api\/v1\/availability\/ requires-body=1, script-path=https://github.com/NSRingo/WeatherKit/releases/download/v3.0.2/response.bundle.js, tag=ðŸŒ¤ ï£¿WeatherKit.api.v1.availability.response, argument=[{Weather.Replace},{Weather.Provider},{NextHour.Fill},{NextHour.Provider},{AirQuality.Current.Fill},{AirQuality.Current.Pollutants.Provider},{AirQuality.Current.Index.Replace},{AirQuality.Current.Index.Provider},{AirQuality.Current.Index.ForceCNPrimaryPollutants},{AirQuality.Comparison.Fill},{AirQuality.Comparison.Yesterday.PollutantsProvider},{AirQuality.Comparison.Yesterday.IndexProvider},{AirQuality.Calculate.Algorithm},{AirQuality.Calculate.AllowOverRange},{API.ColorfulClouds.Token},{API.QWeather.Host},{API.QWeather.Token},{API.WAQI.Token},{Storage},{LogLevel}]
http-request ^https?:\/\/weatherkit\.apple\.com\/api\/v2\/weather\/ script-path=https://github.com/NSRingo/WeatherKit/releases/download/v3.0.2/request.bundle.js, tag=ðŸŒ¤ ï£¿WeatherKit.api.v1.weather.request, argument=[{Weather.Replace},{Weather.Provider},{NextHour.Fill},{NextHour.Provider},{AirQuality.Current.Fill},{AirQuality.Current.Pollutants.Provider},{AirQuality.Current.Index.Replace},{AirQuality.Current.Index.Provider},{AirQuality.Current.Index.ForceCNPrimaryPollutants},{AirQuality.Comparison.Fill},{AirQuality.Comparison.Yesterday.PollutantsProvider},{AirQuality.Comparison.Yesterday.IndexProvider},{AirQuality.Calculate.Algorithm},{AirQuality.Calculate.AllowOverRange},{API.ColorfulClouds.Token},{API.QWeather.Host},{API.QWeather.Token},{API.WAQI.Token},{Storage},{LogLevel}]
http-response ^https?:\/\/weatherkit\.apple\.com\/api\/v2\/weather\/ requires-body=1, binary-body-mode=1, script-path=https://github.com/NSRingo/WeatherKit/releases/download/v3.0.2/response.bundle.js, tag=ðŸŒ¤ ï£¿WeatherKit.api.v2.weather.response, argument=[{Weather.Replace},{Weather.Provider},{NextHour.Fill},{NextHour.Provider},{AirQuality.Current.Fill},{AirQuality.Current.Pollutants.Provider},{AirQuality.Current.Index.Replace},{AirQuality.Current.Index.Provider},{AirQuality.Current.Index.ForceCNPrimaryPollutants},{AirQuality.Comparison.Fill},{AirQuality.Comparison.Yesterday.PollutantsProvider},{AirQuality.Comparison.Yesterday.IndexProvider},{AirQuality.Calculate.Algorithm},{AirQuality.Calculate.AllowOverRange},{API.ColorfulClouds.Token},{API.QWeather.Host},{API.QWeather.Token},{API.WAQI.Token},{Storage},{LogLevel}]

[MITM]
hostname = weatherkit.apple.com
